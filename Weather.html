<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactie Weergrafiek</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Three.js voor animaties -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.131.3/build/three.min.js"></script>

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

  <!-- Jouw CSS -->
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""
          defer></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0; height: 100%;
      transition: background 1s ease-in-out;
      background-size: cover;
    }
    .container {
      max-width: 900px; margin: 50px auto;
      padding: 20px;
      background: rgba(255,255,255,0.8);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 { text-align: center; }
    canvas { margin-top: 30px; }
    button {
      padding: 10px; font-size: 16px;
      margin: 10px 0; width: 100%;
      border-radius: 6px; border: 1px solid #ccc;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>üå§Ô∏è Interactieve Weersvoorspelling</h2>
    <button onclick="getWeatherByIP()">Zoek Weer op je Locatie (IP)</button>
    <canvas id="weatherChart" height="100"></canvas>
    <a href="/portfolio.html" class="btn btn-secondary mt-3">Terug naar portfolio</a>
  </div>

  <script>
    const API_KEY = "f32f9b8e576065966ba174743ebb30f0"; // OpenWeatherMap API Key
    let chartInstance, scene, camera, renderer, rain;

    function setBackground(desc) {
      if (desc.includes("clear")) {
        document.body.style.backgroundImage = "url('https://example.com/sunny.jpg')"; addStars();
      } else if (desc.includes("rain")) {
        document.body.style.backgroundImage = "url('https://example.com/rain.jpg')"; addRain();
      } else if (desc.includes("cloud")) {
        document.body.style.backgroundImage = "url('https://example.com/cloudy.jpg')"; addClouds();
      } else if (desc.includes("storm")) {
        document.body.style.backgroundImage = "url('https://example.com/storm.jpg')"; addLightning();
      } else {
        document.body.style.backgroundImage = "url('https://example.com/default.jpg')";
      }
    }

    function addStars() {
      cleanupScene();
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({alpha:true});
      renderer.setSize(innerWidth, innerHeight);
      document.body.appendChild(renderer.domElement);
      const geo = new THREE.SphereGeometry(1,32,32);
      const mat = new THREE.MeshBasicMaterial({color:0xffff00});
      const star = new THREE.Mesh(geo,mat); scene.add(star);
      camera.position.z=5;
      (function animate(){ requestAnimationFrame(animate);
        star.rotation.x+=0.01; star.rotation.y+=0.01;
        renderer.render(scene,camera);
      })();
    }

    function addRain() {
      cleanupScene();
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({alpha:true});
      renderer.setSize(innerWidth, innerHeight);
      document.body.appendChild(renderer.domElement);
      const geo = new THREE.BufferGeometry();
      const verts = [];
      for(let i=0;i<1000;i++){
        verts.push((Math.random()*200-100),(Math.random()*200-100),(Math.random()*200-100));
      }
      geo.setAttribute('position',new THREE.Float32BufferAttribute(verts,3));
      const mat = new THREE.PointsMaterial({color:0x00aaff, size:0.1});
      rain = new THREE.Points(geo,mat); scene.add(rain);
      camera.position.z=5;
      (function animate(){ requestAnimationFrame(animate);
        rain.rotation.x+=0.01; rain.rotation.y+=0.01;
        renderer.render(scene,camera);
      })();
    }

    function addClouds() { cleanupScene(); /* eventueel wolken‚Äêanim */ }
    function addLightning() { cleanupScene(); /* eventueel bliksem‚Äêanim */ }

    function cleanupScene() {
      if(renderer){ renderer.domElement.remove(); renderer.dispose(); }
    }

    async function getWeatherByIP() {
      try {
        const locRes = await fetch("https://ipapi.co/json/");
        const loc = await locRes.json();
        const { city, latitude:lat, longitude:lon } = loc;
        const weatherRes = await fetch(
          `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=nl`
        );
        const data = await weatherRes.json();
        const slice = data.list.slice(0,8);
        const temps = slice.map(p=>p.main.temp);
        const labels = slice.map(p=>new Date(p.dt_txt).getHours()+":00");
        const desc = slice[0].weather[0].description;
        setBackground(desc);

        const ctx = document.getElementById("weatherChart").getContext("2d");
        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
          type: "line",
          data: { labels, datasets:[{
            label: `üå°Ô∏è Temp. in ${city} (¬∞C)`,
            data: temps,
            backgroundColor:"rgba(54,162,235,0.2)",
            borderColor:"rgba(54,162,235,1)",
            borderWidth:2, fill:true, tension:0.3
          }]},
          options:{ responsive:true, scales:{ y:{ beginAtZero:false } } }
        });

      } catch(err) {
        alert("Fout: "+ err.message);
      }
    }
  </script>

</body>
</html>
